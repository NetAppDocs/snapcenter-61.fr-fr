---
permalink: protect-nsp/clone_from_a_backup.html 
sidebar: sidebar 
keywords: clone 
summary: 'Vous pouvez utiliser SnapCenter pour cloner une sauvegarde.  Vous pouvez cloner à partir d"une sauvegarde principale ou secondaire.  Les capacités des opérations de clonage dépendent du plug-in que vous utilisez.' 
---
= Cloner à partir d'une sauvegarde
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Vous pouvez utiliser SnapCenter pour cloner une sauvegarde.  Vous pouvez cloner à partir d'une sauvegarde principale ou secondaire.  Les capacités des opérations de clonage dépendent du plug-in que vous utilisez.

.Avant de commencer
* Vous devez avoir sauvegardé les ressources ou le groupe de ressources.
* L'opération de clonage par défaut clone uniquement les objets de stockage.  Les opérations de clonage au niveau de l'application ne peuvent être effectuées que si le plug-in pris en charge par NetApp fournit cette capacité.
* Vous devez vous assurer que les agrégats hébergeant les volumes doivent figurer dans la liste des agrégats attribués de la machine virtuelle de stockage (SVM).


.À propos de cette tâche
Pour ONTAP 9.12.1 et les versions antérieures, les clones créés à partir des instantanés SnapLock Vault dans le cadre de la restauration hériteront du délai d'expiration de SnapLock Vault. L'administrateur de stockage doit nettoyer manuellement les clones après l'expiration de SnapLock .

[role="tabbed-block"]
====
.Interface utilisateur de SnapCenter
--
.Étapes
. Dans le volet de navigation de gauche, cliquez sur *Ressources*, puis sélectionnez le plug-in approprié dans la liste.
. Dans la page *Ressources*, filtrez les ressources de la liste déroulante *Affichage* en fonction du type de ressource.
+
Les ressources sont affichées avec des informations telles que le type, le nom de l'hôte ou du cluster, les groupes de ressources et les politiques associés, ainsi que l'état.

. Sélectionnez la ressource ou le groupe de ressources.
+
Vous devez sélectionner une ressource si vous sélectionnez un groupe de ressources.

+
La page de topologie des ressources ou du groupe de ressources s'affiche.

. Dans la vue Gérer les copies, sélectionnez *Sauvegardes* à partir des systèmes de stockage principal ou secondaire (en miroir ou en coffre).
. Sélectionnez la sauvegarde des données dans le tableau, puis cliquez surimage:../media/clone_icon.gif["icône de clonage"] .
. Dans la page Emplacements, procédez comme suit :
+
|===
| Pour ce domaine... | Fais ceci... 


 a| 
Cloner le serveur
 a| 
Par défaut, l'hôte source est renseigné.

Si vous souhaitez spécifier un hôte différent, sélectionnez l'hôte sur lequel le clone doit être monté et le plug-in est installé.



 a| 
Suffixe de clonage
 a| 
Ceci est obligatoire lorsque la destination du clone est la même que la source.

Saisissez un suffixe qui sera ajouté au nom de la ressource nouvellement clonée.  Le suffixe garantit que la ressource clonée est unique sur l'hôte.

Par exemple, rs1_clone.  Si vous effectuez un clonage sur le même hôte que la ressource d'origine, vous devez fournir un suffixe pour différencier la ressource clonée de la ressource d'origine ; sinon, l'opération échoue.

|===
+
Si la ressource sélectionnée est un LUN et si vous effectuez un clonage à partir d'une sauvegarde secondaire, les volumes de destination sont répertoriés.  Une source unique peut avoir plusieurs volumes de destination.

. Dans la page *Paramètres*, procédez comme suit :
+
|===
| Pour ce domaine... | Fais ceci... 


 a| 
Nom de l'initiateur
 a| 
Saisissez le nom de l'initiateur de l'hôte, qui est soit un IQDN, soit un WWPN.



 a| 
Protocole Igroup
 a| 
Sélectionnez le protocole Igroup.

|===
+

NOTE: La page Paramètres s'affiche uniquement si le type de stockage est LUN.

. Dans la page Scripts, entrez les commandes de pré-clonage ou de post-clonage qui doivent être exécutées respectivement avant ou après l'opération de clonage.  Entrez la commande mount pour monter un système de fichiers sur un hôte.
+
Par exemple:

+
** Commande de pré-clonage : supprimer les bases de données existantes portant le même nom
** Commande de post-clonage : vérifier une base de données ou démarrer une base de données.
+
Commande de montage pour un volume ou un qtree sur une machine Linux : mount<VSERVER_NAME>:%<VOLUME_NAME_Clone /mnt>



. Dans la page *Notification*, dans la liste déroulante *Préférence de courrier électronique*, sélectionnez les scénarios dans lesquels vous souhaitez envoyer les courriers électroniques.
+
Vous devez également spécifier les adresses e-mail de l'expéditeur et du destinataire, ainsi que l'objet de l'e-mail.

. Consultez le résumé et cliquez sur *Terminer*.
. Surveillez la progression de l'opération en cliquant sur *Surveiller* > *Tâches*.


--
.applets de commande PowerShell
--
.Étapes
. Lancez une session de connexion avec le serveur SnapCenter pour un utilisateur spécifié à l’aide de l’applet de commande Open-SmConnection.
+
[listing]
----
Open-SmConnection  -SMSbaseurl  https:\\snapctr.demo.netapp.com:8146/
----
. Répertoriez les sauvegardes qui peuvent être clonées à l’aide de l’applet de commande Get-SmBackup ou Get-SmResourceGroup.
+
Cet exemple affiche des informations sur toutes les sauvegardes disponibles :

+
[listing]
----
 C:\PS>PS C:\> Get-SmBackup

BackupId                      BackupName                    BackupTime                    BackupType
--------                      ----------                    ----------                    ----------
   1              Payroll Dataset_vise-f6_08... 8/4/2015    11:02:32 AM                   Full Backup
   2              Payroll Dataset_vise-f6_08... 8/4/2015    11:23:17 AM
----
+
Cet exemple affiche des informations sur un groupe de ressources spécifié :

+
[listing]
----
PS C:\> Get-SmResourceGroup

    Description                 :
    CreationTime                : 10/10/2016 4:45:53 PM
    ModificationTime            : 10/10/2016 4:45:53 PM
    EnableEmail                 : False
    EmailSMTPServer             :
    EmailFrom                   :
    EmailTo                     :
    EmailSubject                :
    EnableSysLog                : False
    ProtectionGroupType         : Backup
    EnableAsupOnFailure         : False
    Policies                    : {}
    HostResourceMaping          : {}
    Configuration               : SMCoreContracts.SmCloneConfiguration
    LastBackupStatus            : Completed
    VerificationServer          :
    EmailBody                   :
    EmailNotificationPreference : Never
    VerificationServerInfo      :
    SchedulerSQLInstance        :
    CustomText                  :
    CustomSnapshotFormat        :
    SearchResources             : False
    ByPassCredential            : False
    IsCustomSnapshot            :
    MaintenanceStatus           : Production
    PluginProtectionGroupTypes  : {SMSQL}
    Tag                         :
    IsInternal                  : False
    EnableEmailAttachment       : False
    VerificationSettings        : {}
    Name                        : NFS_DB
    Type                        : Group
    Id                          : 2
    Host                        :
    UserName                    :
    Passphrase                  :
    Deleted                     : False
    Auth                        : SMCoreContracts.SmAuth
    IsClone                     : False
    CloneLevel                  : 0
    Hosts                       :
    StorageName                 :
    ResourceGroupNames          :
    PolicyNames                 :

    Description                 :
    CreationTime                : 10/10/2016 4:51:36 PM
    ModificationTime            : 10/10/2016 5:27:57 PM
    EnableEmail                 : False
    EmailSMTPServer             :
    EmailFrom                   :
    EmailTo                     :
    EmailSubject                :
    EnableSysLog                : False
    ProtectionGroupType         : Backup
    EnableAsupOnFailure         : False
    Policies                    : {}
    HostResourceMaping          : {}
    Configuration               : SMCoreContracts.SmCloneConfiguration
    LastBackupStatus            : Failed
    VerificationServer          :
    EmailBody                   :
    EmailNotificationPreference : Never
    VerificationServerInfo      :
    SchedulerSQLInstance        :
    CustomText                  :
    CustomSnapshotFormat        :
    SearchResources             : False
    ByPassRunAs                 : False
    IsCustomSnapshot            :
    MaintenanceStatus           : Production
    PluginProtectionGroupTypes  : {SMSQL}
    Tag                         :
    IsInternal                  : False
    EnableEmailAttachment       : False
    VerificationSettings        : {}
    Name                        : Test
    Type                        : Group
    Id                          : 3
    Host                        :
    UserName                    :
    Passphrase                  :
    Deleted                     : False
    Auth                        : SMCoreContracts.SmAuth
    IsClone                     : False
    CloneLevel                  : 0
    Hosts                       :
    StorageName                 :
    ResourceGroupNames          :
    PolicyNames                 :
----
. Lancez une opération de clonage à partir d’un groupe de ressources de clonage ou d’une sauvegarde existante à l’aide de l’applet de commande New-SmClone.
+
Cet exemple crée un clone à partir d’une sauvegarde spécifiée avec tous les journaux :

+
[listing]
----
New-SmClone -BackupName Verify_delete_clone_on_qtree_windows_scc54_10-04-2016_19.05.48.0886 -Resources @{"Host"="scc54.sccore.test.com";"Uid"="QTREE1"}  -
CloneToInstance scc54.sccore.test.com -Suffix '_QtreeCloneWin9'  -AutoAssignMountPoint -AppPluginCode 'DummyPlugin' -initiatorname 'iqn.1991-
05.com.microsoft:scc54.sccore.test.com' -igroupprotocol 'mixed'
----
. Affichez l’état du travail de clonage à l’aide de l’applet de commande Get-SmCloneReport.
+
Cet exemple affiche un rapport de clonage pour l’ID de tâche spécifié :

+
[listing]
----
PS C:\> Get-SmCloneReport -JobId 186

    SmCloneId           : 1
    SmJobId             : 186
    StartDateTime       : 8/3/2015 2:43:02 PM
    EndDateTime         : 8/3/2015 2:44:08 PM
    Duration            : 00:01:06.6760000
    Status              : Completed
    ProtectionGroupName : Draper
    SmProtectionGroupId : 4
    PolicyName          : OnDemand_Clone
    SmPolicyId          : 4
    BackupPolicyName    : OnDemand_Full_Log
    SmBackupPolicyId    : 1
    CloneHostName       : SCSPR0054212005.mycompany.com
    CloneHostId         : 4
    CloneName           : Draper__clone__08-03-2015_14.43.53
    SourceResources     : {Don, Betty, Bobby, Sally}
    ClonedResources     : {Don_DRAPER, Betty_DRAPER, Bobby_DRAPER, Sally_DRAPER}
    SmJobError          :
----


--
====