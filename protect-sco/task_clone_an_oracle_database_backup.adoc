---
permalink: protect-sco/task_clone_an_oracle_database_backup.html 
sidebar: sidebar 
keywords: Credentials, alternate host, clone, FRA, OMF 
summary: 'Vous pouvez utiliser SnapCenter pour cloner une base de données Oracle à l"aide de la sauvegarde de la base de données.' 
---
= Cloner une sauvegarde de base de données Oracle
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Vous pouvez utiliser SnapCenter pour cloner une base de données Oracle à l'aide de la sauvegarde de la base de données.

*Avant de commencer*

Si vous avez installé le plug-in en tant qu'utilisateur non root, vous devez attribuer manuellement les autorisations d'exécution aux répertoires prescript et postscript.

*À propos de cette tâche*

* L'opération de clonage crée une copie des fichiers de données de la base de données et crée de nouveaux fichiers journaux de rétablissement en ligne et des fichiers de contrôle.  La base de données peut être éventuellement récupérée à une heure spécifiée, en fonction des options de récupération spécifiées.
+

NOTE: Le clonage échoue si vous essayez de cloner une sauvegarde créée sur un hôte Linux vers un hôte AIX ou vice-versa.

+
SnapCenter crée une base de données autonome lorsqu'elle est clonée à partir d'une sauvegarde de base de données Oracle RAC.  SnapCenter prend en charge la création d'un clone à partir de la sauvegarde d'une base de données de secours Data Guard et d'une base de données de secours Active Data Guard.

+
Lors du clonage, SnapCenter monte le nombre optimal de sauvegardes de journaux en fonction du SCN ou de la date et de l'heure pour les opérations de récupération.  Après la récupération, la sauvegarde du journal est démontée.  Tous ces clones sont montés sous _/var/opt/snapcenter/scu/clones/_.  Si vous utilisez ASM sur NFS, vous devez ajouter _/var/opt/snapcenter/scu/clones/*/*_ au chemin existant défini dans le paramètre asm_diskstring.

+
Lors du clonage d'une sauvegarde d'une base de données ASM dans un environnement SAN, les règles udev pour les périphériques hôtes clonés sont créées dans _/etc/udev/rules.d/999-scu-netapp.rules_.  Ces règles udev associées aux périphériques hôtes clonés sont supprimées lorsque vous supprimez le clone.

+

NOTE: Dans une configuration Flex ASM, vous ne pouvez pas effectuer d'opération de clonage sur les nœuds feuille si la cardinalité est inférieure au nombre de nœuds dans le cluster RAC.

* Pour les stratégies activées par SnapLock , pour ONTAP 9.12.1 et les versions antérieures, si vous spécifiez une période de verrouillage des snapshots, les clones créés à partir des snapshots inviolables dans le cadre de la restauration hériteront du délai d'expiration de SnapLock . L'administrateur de stockage doit nettoyer manuellement les clones après l'expiration de SnapLock .


.Étapes
. Dans le volet de navigation de gauche, cliquez sur *Ressources*, puis sélectionnez le plug-in approprié dans la liste.
. Dans la page Ressources, sélectionnez *Base de données* ou *Groupe de ressources* dans la liste *Affichage*.
. Sélectionnez la base de données soit à partir de la vue des détails de la base de données, soit à partir de la vue des détails du groupe de ressources.
+
La page de topologie de la base de données s'affiche.

. Dans la vue Gérer les copies, sélectionnez les sauvegardes parmi les copies locales (principales), les copies miroir (secondaires) ou les copies Vault (secondaires).
. Sélectionnez la sauvegarde des données dans le tableau, puis cliquez sur *image:../media/clone_icon.gif["icône de clonage"] *.
. Dans la page Nom, effectuez l’une des actions suivantes :
+
|===
| Si vous voulez... | Mesures... 


 a| 
Cloner une base de données (CDB ou non CDB)
 a| 
.. Spécifiez le SID du clone.
+
Le SID cloné n'est pas disponible par défaut et la longueur maximale du SID est de 8 caractères.

+

NOTE: Vous devez vous assurer qu’aucune base de données avec le même SID n’existe sur l’hôte où le clone sera créé.





 a| 
Cloner une base de données enfichable (PDB)
 a| 
.. Sélectionnez *PDB Clone*.
.. Spécifiez le PDB que vous souhaitez cloner.
.. Spécifiez le nom du PDB cloné.  Pour les étapes détaillées pour cloner un PDB, voirlink:../protect-sco/task_clone_a_pluggable_database.html["Cloner une base de données enfichable"^] .


|===
+
Lorsque vous sélectionnez des données en miroir ou en coffre-fort :

+
** s'il n'y a pas de sauvegarde de journal sur le miroir ou le coffre-fort, rien n'est sélectionné et les localisateurs sont vides.
** si des sauvegardes de journaux existent dans un miroir ou un coffre-fort, la dernière sauvegarde de journal est sélectionnée et le localisateur correspondant est affiché.
+

NOTE: Si la sauvegarde du journal sélectionnée existe à la fois dans l'emplacement miroir et dans l'emplacement du coffre-fort, les deux localisateurs sont affichés.



. Dans la page Emplacements, effectuez les actions suivantes :
+
|===
| Pour ce domaine... | Fais ceci... 


 a| 
Hôte clone
 a| 
Par défaut, l'hôte de la base de données source est renseigné.

Si vous souhaitez créer le clone sur un autre hôte, sélectionnez l'hôte ayant la même version d'Oracle et du même système d'exploitation que celui de l'hôte de la base de données source.



 a| 
Emplacements des fichiers de données
 a| 
Par défaut, l'emplacement du fichier de données est renseigné.

La convention de dénomination par défaut de SnapCenter pour les systèmes de fichiers SAN ou NFS est FileSystemNameofsourcedatabase_CLONESID.

La convention de dénomination par défaut de SnapCenter pour les groupes de disques ASM est SC_HASHCODEofDISKGROUP_CLONESID.  Le HASHCODEofDISKGROUP est un numéro généré automatiquement (2 à 10 chiffres) qui est unique pour chaque groupe de disques ASM.


NOTE: Si vous personnalisez le nom du groupe de disques ASM, assurez-vous que la longueur du nom respecte la longueur maximale prise en charge par Oracle.

Si vous souhaitez spécifier un chemin différent, vous devez saisir les points de montage du fichier de données ou les noms des groupes de disques ASM pour la base de données clonée.  Lorsque vous personnalisez le chemin du fichier de données, vous devez également modifier les noms des groupes de disques ASM ou du système de fichiers du fichier de contrôle et du fichier journal de rétablissement, soit par le même nom que celui utilisé pour les fichiers de données, soit par un groupe de disques ASM ou un système de fichiers existant.



 a| 
Fichiers de contrôle
 a| 
Par défaut, le chemin du fichier de contrôle est renseigné.

Les fichiers de contrôle sont placés dans le même groupe de disques ASM ou système de fichiers que celui des fichiers de données.  Si vous souhaitez remplacer le chemin du fichier de contrôle, vous pouvez fournir un chemin de fichier de contrôle différent.


NOTE: Le système de fichiers ou le groupe de disques ASM doit exister sur l'hôte.

Par défaut, le nombre de fichiers de contrôle sera le même que celui de la base de données source.  Vous pouvez modifier le nombre de fichiers de contrôle, mais un minimum d'un fichier de contrôle est requis pour cloner la base de données.

Vous pouvez personnaliser le chemin du fichier de contrôle vers un système de fichiers différent (existant) de celui de la base de données source.



 a| 
Journaux de rétablissement
 a| 
Par défaut, le groupe de fichiers journaux de rétablissement, le chemin et leurs tailles sont renseignés.

Les journaux de rétablissement sont placés dans le même groupe de disques ou système de fichiers ASM que celui des fichiers de données de la base de données clonée.  Si vous souhaitez remplacer le chemin du fichier journal de rétablissement, vous pouvez personnaliser le chemin du fichier journal de rétablissement vers un système de fichiers différent de celui de la base de données source.


NOTE: Le nouveau système de fichiers ou le groupe de disques ASM doit exister sur l'hôte.

Par défaut, le nombre de groupes de journaux de rétablissement, de fichiers journaux de rétablissement et leurs tailles seront les mêmes que ceux de la base de données source.  Vous pouvez modifier les paramètres suivants :

** Nombre de groupes de journaux de rétablissement



NOTE: Un minimum de deux groupes de journaux de rétablissement sont requis pour cloner la base de données.

** Répéter les fichiers journaux dans chaque groupe et leur chemin
+
Vous pouvez personnaliser le chemin du fichier journal de rétablissement vers un système de fichiers différent (existant) de celui de la base de données source.




NOTE: Au moins un fichier journal de rétablissement est requis dans le groupe de journaux de rétablissement pour cloner la base de données.

** Tailles du fichier journal de rétablissement


|===
. Sur la page Informations d’identification, effectuez les actions suivantes :
+
|===
| Pour ce domaine... | Fais ceci... 


 a| 
Nom d'identification pour l'utilisateur système
 a| 
Sélectionnez les informations d’identification à utiliser pour définir le mot de passe de l’utilisateur système de la base de données clonée.

Si SQLNET.AUTHENTICATION_SERVICES est défini sur NONE dans le fichier sqlnet.ora sur l'hôte cible, vous ne devez pas sélectionner *Aucun* comme informations d'identification dans l'interface graphique de SnapCenter .



 a| 
Nom des informations d'identification de l'instance ASM
 a| 
Sélectionnez *Aucun* si l’authentification du système d’exploitation est activée pour la connexion à l’instance ASM sur l’hôte clone.

Sinon, sélectionnez les informations d'identification Oracle ASM configurées avec l'utilisateur « sys » ou un utilisateur disposant du privilège « sysasm » applicable à l'hôte clone.

|===
+
Les détails de la page d'accueil Oracle, du nom d'utilisateur et du groupe sont automatiquement renseignés à partir de la base de données source.  Vous pouvez modifier les valeurs en fonction de l’environnement Oracle de l’hôte sur lequel le clone sera créé.

. Dans la page PreOps, effectuez les étapes suivantes :
+
.. Entrez le chemin et les arguments du prescript que vous souhaitez exécuter avant l'opération de clonage.
+
Vous devez stocker le prescript soit dans _/var/opt/snapcenter/spl/scripts_ soit dans n'importe quel dossier à l'intérieur de ce chemin.  Par défaut, le chemin _/var/opt/snapcenter/spl/scripts_ est renseigné.  Si vous avez placé le script dans un dossier à l'intérieur de ce chemin, vous devez fournir le chemin complet jusqu'au dossier où le script est placé.

+
SnapCenter vous permet d'utiliser les variables d'environnement prédéfinies lorsque vous exécutez le prescript et le postscript.link:../protect-sco/predefined-environment-variables-prescript-postscript-clone.html["Apprendre encore plus"^]

.. Dans la section Paramètres de la base de données, modifiez les valeurs des paramètres de base de données préremplis utilisés pour initialiser la base de données.
+
Vous pouvez ajouter des paramètres supplémentaires en cliquant sur *image:../media/add_policy_from_resourcegroup.gif["ajouter un groupe de ressources de formulaire de politique"] *.

+
Si vous utilisez Oracle Standard Edition et que la base de données s'exécute en mode journal d'archivage ou que vous souhaitez restaurer une base de données à partir du journal de rétablissement d'archive, ajoutez les paramètres et spécifiez le chemin d'accès.

+
*** ARCHIVE_LOG_DEST
*** ARCHIVE_JOURNAL_DUPLEX_DEST
+

NOTE: La zone de récupération rapide (FRA) n'est pas définie dans les paramètres de base de données préremplis.  Vous pouvez configurer FRA en ajoutant les paramètres associés.

+

NOTE: La valeur par défaut de log_archive_dest_1 est $ORACLE_HOME/clone_sid et les journaux d'archive de la base de données clonée seront créés à cet emplacement.  Si vous avez supprimé le paramètre log_archive_dest_1, l'emplacement du journal d'archive est déterminé par Oracle.  Vous pouvez définir un nouvel emplacement pour le journal d'archive en modifiant log_archive_dest_1, mais assurez-vous que le système de fichiers ou le groupe de disques doit exister et être disponible sur l'hôte.



.. Cliquez sur *Réinitialiser* pour obtenir les paramètres de base de données par défaut.


. Dans la page PostOps, *Récupérer la base de données* et *Jusqu'à annulation* sont sélectionnés par défaut pour effectuer la récupération de la base de données clonée.
+
SnapCenter effectue la récupération en montant la dernière sauvegarde de journal contenant la séquence ininterrompue de journaux d'archive après la sauvegarde de données sélectionnée pour le clonage.  La sauvegarde du journal et des données doit être effectuée sur le stockage principal pour effectuer le clonage sur le stockage principal et la sauvegarde du journal et des données doit être effectuée sur le stockage secondaire pour effectuer le clonage sur le stockage secondaire.

+
Les options *Récupérer la base de données* et *Jusqu'à annulation* ne sont pas sélectionnées si SnapCenter ne parvient pas à trouver les sauvegardes de journaux appropriées.  Vous pouvez fournir l'emplacement du journal d'archive externe si la sauvegarde du journal n'est pas disponible dans *Spécifier les emplacements du journal d'archive externe*.  Vous pouvez spécifier plusieurs emplacements de journaux.

+

NOTE: Si vous souhaitez cloner une base de données source configurée pour prendre en charge la zone de récupération flash (FRA) et Oracle Managed Files (OMF), la destination du journal pour la récupération doit également respecter la structure du répertoire OMF.

+
La page PostOps ne s'affiche pas si la base de données source est une base de données de secours Data Guard ou une base de données de secours Active Data Guard.  Pour une base de données de secours Data Guard ou une base de données de secours Active Data Guard, SnapCenter ne fournit pas d'option permettant de sélectionner le type de récupération dans l'interface graphique SnapCenter , mais la base de données est récupérée à l'aide du type de récupération Jusqu'à annulation sans appliquer de journaux.

+
|===
| Nom du champ | Description 


 a| 
Jusqu'à l'annulation
 a| 
SnapCenter effectue la récupération en montant la dernière sauvegarde du journal contenant la séquence ininterrompue des journaux d'archive après cette sauvegarde de données sélectionnée pour le clonage.  La base de données clonée est récupérée jusqu'au fichier journal manquant ou corrompu.



 a| 
Date et heure
 a| 
SnapCenter récupère la base de données jusqu'à une date et une heure spécifiées.  Le format accepté est mm/jj/aaaa hh:mm:ss.


NOTE: L'heure peut être spécifiée au format 24 heures.



 a| 
Jusqu'au SCN (System Change Number)
 a| 
SnapCenter récupère la base de données jusqu'à un numéro de modification système (SCN) spécifié.



 a| 
Spécifier les emplacements des journaux d'archives externes
 a| 
Si la base de données s'exécute en mode ARCHIVELOG, SnapCenter identifie et monte le nombre optimal de sauvegardes de journaux en fonction du SCN spécifié ou de la date et de l'heure sélectionnées.

Vous pouvez également spécifier l’emplacement du journal d’archive externe.


NOTE: SnapCenter n'identifiera pas et ne montera pas automatiquement les sauvegardes de journaux si vous avez sélectionné Jusqu'à annuler.



 a| 
Créer un nouveau DBID
 a| 
Par défaut, la case à cocher *Créer un nouveau DBID* est sélectionnée pour générer un numéro unique (DBID) pour la base de données clonée, la différenciant de la base de données source.

Décochez la case si vous souhaitez attribuer le DBID de la base de données source à la base de données clonée.  Dans ce scénario, si vous souhaitez enregistrer la base de données clonée auprès du catalogue RMAN externe où la base de données source est déjà enregistrée, l'opération échoue.



 a| 
Créer un fichier temporaire pour l'espace table temporaire
 a| 
Cochez la case si vous souhaitez créer un fichier temporaire pour l’espace table temporaire par défaut de la base de données clonée.

Si la case à cocher n'est pas sélectionnée, le clone de base de données sera créé sans le fichier temporaire.



 a| 
Saisissez les entrées SQL à appliquer lors de la création du clone
 a| 
Ajoutez les entrées SQL que vous souhaitez appliquer lors de la création du clone.



 a| 
Entrez les scripts à exécuter après l'opération de clonage
 a| 
Spécifiez le chemin et les arguments du postscript que vous souhaitez exécuter après l'opération de clonage.

Vous devez stocker le postscript soit dans _/var/opt/snapcenter/spl/scripts_ soit dans n'importe quel dossier à l'intérieur de ce chemin.  Par défaut, le chemin _/var/opt/snapcenter/spl/scripts_ est renseigné.

Si vous avez placé le script dans un dossier à l'intérieur de ce chemin, vous devez fournir le chemin complet jusqu'au dossier où le script est placé.


NOTE: Si l'opération de clonage échoue, les postscripts ne seront pas exécutés et les activités de nettoyage seront déclenchées directement.

|===
. Dans la page Notification, dans la liste déroulante *Préférence de courrier électronique*, sélectionnez les scénarios dans lesquels vous souhaitez envoyer les courriers électroniques.
+
Vous devez également spécifier les adresses e-mail de l'expéditeur et du destinataire, ainsi que l'objet de l'e-mail.  Si vous souhaitez joindre le rapport de l'opération de clonage effectuée, sélectionnez *Joindre le rapport de travail*.

+

NOTE: Pour la notification par e-mail, vous devez avoir spécifié les détails du serveur SMTP à l’aide de l’interface graphique ou de la commande PowerShell Set-SmSmtpServer.

. Consultez le résumé, puis cliquez sur *Terminer*.
+

NOTE: Lors de l'exécution de la récupération dans le cadre de l'opération de création de clone, même si la récupération échoue, le clone est créé avec un avertissement.  Vous pouvez effectuer une récupération manuelle sur ce clone pour ramener la base de données clonée à un état cohérent.

. Surveillez la progression de l'opération en cliquant sur *Surveiller* > *Tâches*.


*Résultat*

Après avoir cloné la base de données, vous pouvez actualiser la page des ressources pour répertorier la base de données clonée comme l'une des ressources disponibles pour la sauvegarde.  La base de données clonée peut être protégée comme n'importe quelle autre base de données à l'aide du flux de travail de sauvegarde standard ou peut être incluse dans un groupe de ressources (nouvellement créé ou existant).  La base de données clonée peut être clonée à nouveau (clone de clones).

Après le clonage, vous ne devez jamais renommer la base de données clonée.


NOTE: Si vous n'avez pas effectué de récupération lors du clonage, la sauvegarde de la base de données clonée peut échouer en raison d'une récupération incorrecte et vous devrez peut-être effectuer une récupération manuelle.  La sauvegarde du journal peut également échouer si l'emplacement par défaut renseigné pour les journaux d'archive se trouve sur un stockage non NetApp ou si le système de stockage n'est pas configuré avec SnapCenter.

Dans la configuration AIX, vous pouvez utiliser la commande lkdev pour verrouiller et la commande rendev pour renommer les disques sur lesquels résidait la base de données clonée.

Le verrouillage ou le changement de nom des appareils n'affectera pas l'opération de suppression du clone.  Pour les dispositions AIX LVM créées sur des périphériques SAN, le changement de nom des périphériques ne sera pas pris en charge pour les périphériques SAN clonés.

*Trouver plus d'informations*

* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/ORA-00308%3A_cannot_open_archived_log_ORA_LOG_arch1_123_456789012.arc["La restauration ou le clonage échoue avec le message d'erreur ORA-00308"^]
* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/Failed_to_recover_a_cloned_database["Échec de la récupération d'une base de données clonée"^]
* https://kb.netapp.com/Advice_and_Troubleshooting/Data_Protection_and_Security/SnapCenter/What_are_the_customizable_parameters_for_backup_restore_and_clone_operations_on_AIX_systems["Paramètres personnalisables pour les opérations de sauvegarde, de restauration et de clonage sur les systèmes AIX"^]




== Mettre à jour l'IP préférée sur l'hôte

Une fois l'opération de clonage terminée, le chemin fourni par la couche d'accès au stockage (SAL) au clone sera au format _<nfs_lif_IP>:<JunctionPath>_.  Pour fournir l'adresse IP préférée, vous devez la configurer sur l'hôte à l'aide des commandes SCCLI.

.Étapes
. Connectez-vous à l'hôte de la base de données.
. Lancer une session de connexion PowerShell avec SnapCenter, pour un utilisateur spécifié.
+
Open-SmConnection

. Créer un fichier vide.
+
appuyez sur /var/opt/snapcenter/scu/etc/storagepreference.properties

. Configurez le LIF de données préféré pour le SVM.
+
Add-SvmPreferredDataPath -SVM <Nom SVM> -DataPath <Adresse IP ou FQDN>

. Vérifiez le chemin préféré.
+
Obtenir-SvmPreferredDataPath


