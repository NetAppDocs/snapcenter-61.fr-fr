---
permalink: protect-sco/task_create_backup_policies_for_oracle_database.html 
sidebar: sidebar 
keywords: backup policies, policies 
summary: 'Avant d"utiliser SnapCenter pour sauvegarder les ressources de base de données Oracle, vous devez créer une stratégie de sauvegarde pour la ressource ou le groupe de ressources que vous souhaitez sauvegarder.  Une politique de sauvegarde est un ensemble de règles qui régissent la manière dont vous gérez, planifiez et conservez les sauvegardes.  Vous pouvez également spécifier les paramètres de réplication, de script et de type de sauvegarde.  La création d’une politique permet de gagner du temps lorsque vous souhaitez réutiliser la politique sur une autre ressource ou un autre groupe de ressources.' 
---
= Créer des politiques de sauvegarde pour les bases de données Oracle
:allow-uri-read: 
:icons: font
:imagesdir: ../media/


[role="lead"]
Avant d'utiliser SnapCenter pour sauvegarder les ressources de base de données Oracle, vous devez créer une stratégie de sauvegarde pour la ressource ou le groupe de ressources que vous souhaitez sauvegarder.  Une politique de sauvegarde est un ensemble de règles qui régissent la manière dont vous gérez, planifiez et conservez les sauvegardes.  Vous pouvez également spécifier les paramètres de réplication, de script et de type de sauvegarde.  La création d’une politique permet de gagner du temps lorsque vous souhaitez réutiliser la politique sur une autre ressource ou un autre groupe de ressources.

*Avant de commencer*

* Vous devez avoir défini votre stratégie de sauvegarde.
* Vous devez vous préparer à la protection des données en effectuant des tâches telles que l'installation de SnapCenter, l'ajout d'hôtes, la découverte de bases de données et la création de connexions au système de stockage.
* Si vous répliquez des snapshots vers un stockage secondaire miroir ou coffre, l'administrateur SnapCenter doit vous avoir attribué les SVM pour les volumes source et de destination.
* Si vous avez installé le plug-in en tant qu'utilisateur non root, vous devez attribuer manuellement les autorisations d'exécution aux répertoires prescript et postscript.
* Consultez les conditions préalables et les limitations spécifiques à la synchronisation active de SnapMirror . Pour plus d'informations, reportez-vous à https://docs.netapp.com/us-en/ontap/smbc/considerations-limits.html#volumes["Limites d'objets pour la synchronisation active de SnapMirror"] .


.À propos de cette tâche
Si l'option « Conserver les copies de sauvegarde pendant un nombre de jours spécifique » est sélectionnée, la période de conservation de SnapLock doit être inférieure ou égale aux jours de conservation mentionnés.

+ La spécification d'une période de verrouillage des instantanés empêche la suppression des instantanés jusqu'à l'expiration de la période de conservation. Cela pourrait conduire à conserver un nombre d’instantanés supérieur au nombre spécifié dans la politique.

+ Pour ONTAP 9.12.1 et les versions antérieures, les clones créés à partir des instantanés SnapLock Vault dans le cadre de la restauration hériteront du délai d'expiration de SnapLock Vault. L'administrateur de stockage doit nettoyer manuellement les clones après l'expiration de SnapLock .

*Mesures*

. Dans le volet de navigation de gauche, cliquez sur *Paramètres*.
. Dans la page Paramètres, cliquez sur *Politiques*.
. Sélectionnez *Base de données Oracle* dans la liste déroulante.
. Cliquez sur *Nouveau*.
. Dans la page Nom, saisissez le nom et les détails de la politique.
. Dans la page Type de politique, procédez comme suit :
+
.. Sélectionnez votre type de stockage.
.. Sélectionner la portée de la politique :
+
*** Si vous souhaitez *créer une sauvegarde en ligne*, sélectionnez *Sauvegarde en ligne*.
+
Vous devez spécifier si vous souhaitez sauvegarder tous les fichiers de données, les fichiers de contrôle et les fichiers journaux d'archive, uniquement les fichiers de données et les fichiers de contrôle, ou uniquement les fichiers journaux d'archive.

*** Si vous souhaitez *créer une sauvegarde hors ligne*, sélectionnez *Sauvegarde hors ligne*, puis sélectionnez l'une des options suivantes :
+
**** Si vous souhaitez créer une sauvegarde hors ligne lorsque la base de données est montée, sélectionnez *Monter*.
**** Si vous souhaitez créer une sauvegarde d'arrêt hors ligne en changeant l'état de la base de données en état d'arrêt, sélectionnez *Arrêt*.
+
Si vous disposez de bases de données enfichables (PDB) et que vous souhaitez enregistrer l'état des PDB avant de créer la sauvegarde, vous devez sélectionner *Enregistrer l'état des PDB*.  Cela vous permet de ramener les PDB à leur état d'origine après la création de la sauvegarde.





.. Si vous souhaitez cataloguer une sauvegarde à l'aide d'Oracle Recovery Manager (RMAN), sélectionnez *Cataloguer une sauvegarde avec Oracle Recovery Manager (RMAN)*.
+
Vous pouvez effectuer un catalogage différé pour une sauvegarde à la fois à l'aide de l'interface graphique utilisateur ou de la commande CLI SnapCenter Catalog-SmBackupWithOracleRMAN.

+

NOTE: Si vous souhaitez cataloguer les sauvegardes d'une base de données RAC, assurez-vous qu'aucune autre tâche n'est en cours d'exécution pour cette base de données.  Si une autre tâche est en cours d’exécution, l’opération de catalogage échoue au lieu d’être mise en file d’attente.

.. Si vous souhaitez élaguer les journaux d'archive après la sauvegarde, sélectionnez *Élaguer les journaux d'archive après la sauvegarde*.
+

NOTE: L'élagage des journaux d'archives de la destination du journal d'archives qui n'est pas configurée dans la base de données sera ignoré.

+

IMPORTANT: Si vous utilisez Oracle Standard Edition, vous pouvez utiliser les paramètres LOG_ARCHIVE_DEST et LOG_ARCHIVE_DUPLEX_DEST lors de la sauvegarde du journal d'archive.

+
*** Vous ne pouvez supprimer les journaux d'archive que si vous avez sélectionné les fichiers journaux d'archive dans le cadre de votre sauvegarde.
+

NOTE: Vous devez vous assurer que tous les nœuds d'un environnement RAC peuvent accéder à tous les emplacements des journaux d'archive pour que l'opération de suppression réussisse.

+
|===
| Si vous voulez... | Alors... 


 a| 
Supprimer tous les journaux d'archives
 a| 
Sélectionnez *Supprimer tous les journaux d'archives*.



 a| 
Supprimer les journaux d'archives plus anciens
 a| 
Sélectionnez *Supprimer les journaux d'archives plus anciens que*, puis spécifiez l'âge des journaux d'archives à supprimer en jours et en heures.



 a| 
Supprimer les journaux d'archives de toutes les destinations
 a| 
Sélectionnez *Supprimer les journaux d’archives de toutes les destinations*.



 a| 
Supprimez les journaux d'archive des destinations de journaux qui font partie de la sauvegarde
 a| 
Sélectionnez *Supprimer les journaux d'archive des destinations qui font partie de la sauvegarde*.

|===
+
image:../media/sco_backuppolicy_prunning.gif["politique d'élagage"]





. Dans la page Instantané et réplication, effectuez les étapes suivantes :
+
.. Spécifiez la fréquence de planification en sélectionnant *À la demande*, *Toutes les heures*, *Quotidien*, *Hebdomadaire* ou *Mensuel*.
+

NOTE: Vous pouvez spécifier la planification (date de début et date de fin) de l'opération de sauvegarde lors de la création d'un groupe de ressources.  Cela vous permet de créer des groupes de ressources qui partagent la même politique et la même fréquence de sauvegarde, mais vous permet d'attribuer des planifications de sauvegarde différentes à chaque politique.

+

NOTE: Si vous avez programmé à 2 h 00 du matin, la planification ne sera pas déclenchée pendant l'heure d'été (DST).

.. Dans la section Paramètres de conservation des instantanés de données, spécifiez les paramètres de conservation pour le type de sauvegarde et le type de planification sélectionné dans la page Type de sauvegarde :
+
|===


| Si vous voulez... | Alors... 


 a| 
Conserver un certain nombre de clichés
 a| 
Sélectionnez *Copies à conserver*, puis spécifiez le nombre d’instantanés que vous souhaitez conserver.

Si le nombre d'instantanés dépasse le nombre spécifié, les instantanés sont supprimés, les copies les plus anciennes étant supprimées en premier.


NOTE: La valeur de rétention maximale est de 1018. Les sauvegardes échoueront si la rétention est définie sur une valeur supérieure à celle prise en charge par la version ONTAP sous-jacente.


IMPORTANT: Vous devez définir le nombre de rétention sur 2 ou plus si vous prévoyez d'activer la réplication SnapVault .  Si vous définissez le nombre de rétention sur 1, l'opération de rétention peut échouer car le premier instantané est l'instantané de référence pour la relation SnapVault jusqu'à ce qu'un instantané plus récent soit répliqué sur la cible.



 a| 
Conservez les instantanés pendant un certain nombre de jours
 a| 
Sélectionnez *Conserver les copies pendant*, puis spécifiez le nombre de jours pendant lesquels vous souhaitez conserver les instantanés avant de les supprimer.



 a| 
Période de verrouillage de la copie instantanée
 a| 
Sélectionnez la *Période de verrouillage de la copie instantanée* et spécifiez la durée en jours, mois ou années.

La période de conservation de SnapLock doit être inférieure à 100 ans.

|===
.. Dans la section Paramètres de conservation des instantanés du journal d'archive, spécifiez les paramètres de conservation pour le type de sauvegarde et le type de planification sélectionné dans la page Type de sauvegarde :
+
|===


| Si vous voulez... | Alors... 


 a| 
Conserver un certain nombre de clichés
 a| 
Sélectionnez *Copies à conserver*, puis spécifiez le nombre d’instantanés que vous souhaitez conserver.

Si le nombre d'instantanés dépasse le nombre spécifié, les instantanés sont supprimés, les copies les plus anciennes étant supprimées en premier.


NOTE: La valeur de rétention maximale est de 1018. Les sauvegardes échoueront si la rétention est définie sur une valeur supérieure à celle prise en charge par la version ONTAP sous-jacente.


IMPORTANT: Vous devez définir le nombre de rétention sur 2 ou plus si vous prévoyez d'activer la réplication SnapVault .  Si vous définissez le nombre de rétention sur 1, l'opération de rétention peut échouer car le premier instantané est l'instantané de référence pour la relation SnapVault jusqu'à ce qu'un instantané plus récent soit répliqué sur la cible.



 a| 
Conservez les instantanés pendant un certain nombre de jours
 a| 
Sélectionnez *Conserver les copies pendant*, puis spécifiez le nombre de jours pendant lesquels vous souhaitez conserver les instantanés avant de les supprimer.



 a| 
Période de verrouillage de la copie instantanée
 a| 
Sélectionnez la *Période de verrouillage de la copie instantanée* et spécifiez la durée en jours, mois ou années.

La période de conservation de SnapLock doit être inférieure à 100 ans.

|===
.. Sélectionnez l'étiquette de la politique.
+

NOTE: Vous pouvez attribuer des étiquettes SnapMirror aux snapshots principaux pour la réplication à distance, permettant ainsi aux snapshots principaux de décharger l'opération de réplication de snapshot de SnapCenter vers les systèmes secondaires ONTAP . Cela peut être fait sans activer l’option SnapMirror ou SnapVault dans la page de politique.



. Dans la section Sélectionner les options de réplication secondaire, sélectionnez l’une ou les deux options de réplication secondaire suivantes :
+

NOTE: Vous devez sélectionner les options de réplication secondaire pour que la *Période de verrouillage de la copie d'instantané secondaire* soit effective.

+
|===
| Pour ce domaine... | Fais ceci... 


 a| 
Mettre à jour SnapMirror après la création d'un snapshot local
 a| 
Sélectionnez ce champ pour créer des copies miroir des jeux de sauvegarde sur un autre volume (réplication SnapMirror ).

Cette option doit être activée pour la synchronisation active de SnapMirror .

Lors de la réplication secondaire, l’heure d’expiration de SnapLock charge l’heure d’expiration de SnapLock principale.

Cliquer sur le bouton *Actualiser* dans la page Topologie actualise l'heure d'expiration du SnapLock secondaire et principal récupérée à partir d' ONTAP.



 a| 
Mettre à jour SnapVault après la création d'un instantané local
 a| 
Sélectionnez cette option pour effectuer une réplication de sauvegarde de disque à disque (sauvegardes SnapVault ).

Lorsque SnapLock est configuré uniquement sur le secondaire d' ONTAP appelé SnapLock Vault, cliquer sur le bouton *Actualiser* dans la page Topologie actualise la période de verrouillage sur le secondaire récupéré à partir d' ONTAP.

Pour plus d'informations sur SnapLock Vault, voir https://docs.netapp.com/us-en/ontap/snaplock/commit-snapshot-copies-worm-concept.html["Valider les copies instantanées vers WORM sur une destination de coffre-fort"]

Voir link:../protect-sco/task_view_oracle_databse_backups_and_clones_in_the_topology_page.html["Afficher les sauvegardes et les clones de la base de données Oracle dans la page Topologie"] .



 a| 
Nombre de tentatives d'erreur
 a| 
Saisissez le nombre maximal de tentatives de réplication pouvant être autorisées avant l’arrêt de l’opération.

|===
+

NOTE: Vous devez configurer la stratégie de rétention SnapMirror dans ONTAP pour le stockage secondaire afin d’éviter d’atteindre la limite maximale de snapshots sur le stockage secondaire.

. Dans la page Script, entrez le chemin et les arguments du prescript ou du postscript que vous souhaitez exécuter respectivement avant ou après l'opération de sauvegarde.
+
Vous devez stocker les prescripts et les postscripts soit dans _/var/opt/snapcenter/spl/scripts_ soit dans n'importe quel dossier à l'intérieur de ce chemin.  Par défaut, le chemin _/var/opt/snapcenter/spl/scripts_ est renseigné.  Si vous avez créé des dossiers dans ce chemin pour stocker les scripts, vous devez spécifier ces dossiers dans le chemin.

+
Vous pouvez également spécifier la valeur du délai d’expiration du script. La valeur par défaut est de 60 secondes.

+
SnapCenter vous permet d'utiliser les variables d'environnement prédéfinies lorsque vous exécutez le prescript et le postscript.link:../protect-sco/predefined-environment-variables-prescript-postscript-backup.html["Apprendre encore plus"^]

. Dans la page de vérification, effectuez les étapes suivantes :
+
.. Sélectionnez la planification de sauvegarde pour laquelle vous souhaitez effectuer l’opération de vérification.
.. Dans la section Commandes du script de vérification, entrez le chemin et les arguments du prescript ou du postscript que vous souhaitez exécuter respectivement avant ou après l'opération de vérification.
+
Vous devez stocker les prescripts et les postscripts soit dans _/var/opt/snapcenter/spl/scripts_ soit dans n'importe quel dossier à l'intérieur de ce chemin.  Par défaut, le chemin _/var/opt/snapcenter/spl/scripts_ est renseigné.  Si vous avez créé des dossiers dans ce chemin pour stocker les scripts, vous devez spécifier ces dossiers dans le chemin.

+
Vous pouvez également spécifier la valeur du délai d’expiration du script. La valeur par défaut est de 60 secondes.



. Consultez le résumé, puis cliquez sur *Terminer*.

